var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(R){return typeof R}:function(R){return R&&"function"===typeof Symbol&&R.constructor===Symbol?"symbol":typeof R};
DC.ready(function(){function R(){console.log.apply(console,arguments)}function ua(){var b=location.search.substr(1),b=b.split("&"),c={},a;b.map(function(b){a=b.split("=");2==a.length&&(c[a[0]]=a[1])});return c}function U(b,c){var a;Z||(Z=b);"undefined"==typeof c&&window.history.pushState(null,null,b);aa.stop();if(ba.notlast()){if((a=ba(Z))&&a.onleave)a.onleave();Z=b;y.close()}""==b&&(b="/");if(la)if(q.authorized)if(f=b,"/"==f)U(Ka);else if(a=ba(f)){N.activate(f);var g=[];"im"==f?(f=a.title(),H||y.check()):
f=a.title;f?(ma.h=f,ma.el.show(),g.push(ma)):ma.el.hide();g.push(a);J.DClist(g);H&&y.adapt()}else J.t="",I.until("undefined...");else{var f=b;J.t="";switch(f){case "/":N.activate(f);J.DClist([La.init()]);break;case "about":N.activate(f);J.DClist([ya.init()]);break;default:U("/")}}else r.show()}function na(){ba||(ba=function(){var b={contacts:Ma,im:Na,sc:Oa,settings:za,about:ya},c=function(c){return(c=b[c])?c.init():!1},a;c.notlast=function(){var b=location.href,c=a!=b;a=b;return c};c.notlast();return c}());
U(location.pathname.substr(1),0);N.init();ca()}function a(){return DC.temp.apply(null,arguments)}function oa(){return DC.emit.apply(null,arguments)}function Pa(b,c){b.err||b.reason?I.is(b.err||b.reason):b[0]?c(b):I.is(b)}function v(){la&&Aa()&&(Aa.inc(),s.emit.apply(s,arguments))}function Ba(b){b?(r.show("authorizing..."),setTimeout(function(){v("auth",{token:b},function(c){if(c[0]&&c.id){S.token=b;q.authorized=1;q.id=c.id;c.name&&(q.name=c.name);if(c.settings){var a={};c.settings.forEach(function(b){a[b.prop]=
b.val});q.settings=a;a.theme&&(q.css.theme=a.theme,ca(a.theme,1))}Qa();v("get_my_userdata")}else delete S.token;na();r.hide();DC.emit("u_login")})})):S.token?Ba(S.token):(r.show("processing data..."),setTimeout(function(){na();r.hide();DC.emit("u_login")}))}function ca(b,c){b?q.css.theme=b:q.css.theme||(q.css.theme="black_white_mn");za.theme.set(q.css.theme,c)}function pa(b){var c=!1;/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(b)&&
(c=!0);return c}function O(b){b.removeClass("pulse_once");b.pulsetimeout&&(clearTimeout(b.pulsetimeout),b.pulsetimeout=0);b.pulsetimeout2&&(clearTimeout(b.pulsetimeout2),b.pulsetimeout2=0);b.pulsetimeout=setTimeout(function(){b.pulsetimeout=0;b.addClass("pulse_once");b.pulsetimeout2=setTimeout(function(){b.removeClass("pulse_once")},Ra)},15)}function n(b){b&&b.preventDefault()}function Ca(){H?(J.el.css({"min-height":""}),J.el.css({height:window.innerHeight-38})):(J.el.css({"min-height":window.innerHeight-
38}),J.el.css({height:"auto"}));N.position()}function da(b){if(null==b||"object"!=("undefined"===typeof b?"undefined":_typeof(b)))return b;var c=b.constructor(),a;for(a in b)b.hasOwnProperty(a)&&(c[a]=da(b[a]));return c}function ea(b,c){if(q.sertd){c?10==(c+"").length&&(c*=1E3):c=Date.now();var a=c-q.sertd;b&&(a=Math.round(a/1E3));return a}return c?c:Date.now()}function Da(b){var c=new Date(ea(0,b));b=""+c.getHours();1==b.length&&(b="0"+b);c=""+c.getMinutes();1==c.length&&(c="0"+c);return b+":"+c}
function Sa(b){var c=new Date(ea(0,b));(""+c.getFullYear()).substr(2,3);c=""+c.getDate()+" ";b=new Date(ea(0,b));b=""+(b.getMonth()+1);switch(b){case "1":b="Jan";break;case "2":b="Feb";break;case "3":b="Mar";break;case "4":b="Apr";break;case "5":b="May";break;case "6":b="Jun";break;case "7":b="Jul";break;case "8":b="Aug";break;case "9":b="Sep";break;case "10":b="Oct";break;case "11":b="Nov";break;case "12":b="Dec"}return c+b}function fa(b){var c=q.id;return b?c==b?!0:!1:c}function Ta(b){var c=a(),
h=b._id,g={},f=g.pic=a({state:{"class":"u_picture_mid"}}),d='<div class="back_line">{pic}</div>';b.userdata&&b.userdata.crop_photo&&f.el.css({"background-image":"url("+V(b.userdata.crop_photo)+")"});b.star&&(d+='<div class="star_friend"></div>');var k=Ua(h);c.timer=g.t=k;c.update=function(){b=D(h);b.userdata.crop_photo&&f.el.css({"background-image":"url("+V(b.userdata.crop_photo)+")"});k.tick()};qa(h,c.update);d+='<div class="inlb" style="vertical-align:top;padding-right: 5px;"><div class="inlb">'+
b.name+'</div><div class="inlb padl5">{t}</div><br />';g.bt=a({eltype:"button",state:{"class":"b",text:"talk"},events:{click:function(){va(h)}}});d+="{bt}</div></div>";return c.parse(d,g)}function va(b,c){v("conv",{act:"start",target:b},function(a){a.ok&&("undefined"==typeof c&&window.history.pushState(null,null,"/im?cid="+a.ok.cid),y.start({target:b,cid:a.ok.cid},1))})}function Va(b,a){if(!b)return console.log("cid undefined");v("conv",{act:"get",cid:b},function(b){b.ok?a(0,b.ok.target):a("error")})}
function Ea(){I.long("You don't have access");U(location.pathname.substr(1))}function Qa(){s.on("newm",function(b){y.received(b)});s.on("viewedm",function(b){y.viewed(b)});s.on("typing",function(b){y.typing(b)});s.on("contact_online",function(b){D.online(b.uid,1);oa("contacts")});s.on("contact_offline",function(b){D.online(b.uid,0);oa("contacts")});s.on("userdata",function(b){for(var a in b)q.userdata[a]=b[a];oa("u_data")});s.on("push",function(b){})}DC.setPseudo(["u_login","tab_active","contacts",
"u_data"]);var q={authorized:0,css:{},userdata:{}},Fa,D=function(){var b={},a={},h={},g=function d(a,c,z){var g=b[a];if(!g)return c||z?d.load(a,c,z):!1;g=da(g);if(c&&z)z(g);else return g};g.updateData=function(a,c){var m=b[a];if(m){for(var g in c)m.userdata[g]=c[g];qa.emit(a)}};g.add=function(d,k){k.online=k.online||1==a[d];k.wasOnline=k.online;var m=b[d];if(m)for(var g in k)m[g]=k[g];else m=b[d]=k;m.userdata||(m.userdata={});1==k.status&&(h[d]=k)};g.load=function(b,a,c){v("user",{act:"get_info",
uid:b},function(z){z.ok?(g.add(b,z.ok),c()):a()})};g.online=function(d,k){a[d]=k?1:0;var m=b[d];m&&(m.online=1==k,m.online||m.online==m.wasOnline||(m.last_v=(new Date).toISOString()),m.wasOnline=m.online)};g.getFriends=function(){return h};g.isOnline=function(b){return 1==a[b]};return g}(),S=localStorage,Ka="contacts",Z,K={},s,la=0,Aa=function(){var b=0;setInterval(function(){b-=170;0>b&&(b=0)},1E4);var a=function(){var a=170>b;a||console.log("request limit exceeded");return a};a.inc=function(){b++};
return a}(),Ra=150,H,ga,ra,sa,Ga=a({eltype:"link",attrs:{rel:"stylesheet"},init:function(){this.insertIn("head")}}),J=a({init:function(){this.insertAs(".body")}}),ha=document.body,V=function(){return function(b){return"https://res.cloudinary.com/mexy-pro/image/upload/"+b}}(),qa=function(){var b={},a=[],h=function(a,c){var d=b[a];d||(d=b[a]=[]);d.push(c)};h.any=function(b){a.push(b)};h.emit=function(g){a.forEach(function(b){return b()});(g=b[g])&&g.forEach(function(b){return b()})};return h}(),ma=
a({state:{"class":"route_title"}}),ba,Ua=function(b){function c(){g=D(b);h&&clearTimeout(h);var a;g&&g.online?a="on":(a=g.last_v||0)&&"on"!=a&&(a=(new Date(a)).getTime());if("on"==a)a="online";else if(a){var m=ea();a=Math.round((m-a)/1E3);2>a?(a="online",h=setTimeout(c,1E3)):86400<=a?(a=Math.round(10*a/86400)/10,a=100>a?a+" d ago":"offline"):3600<=a?(a=Math.round(10*a/3600)/10,a+=" h ago",h=setTimeout(c,36E4)):60<=a?(a=Math.round(a/=60),a+=" min ago",h=setTimeout(c,6E4)):(a+=" sec ago",h=setTimeout(c,
1E3))}else a="offline";a!=f&&(f=a,"online"==f?d.addClass("last_v_on"):d.removeClass("last_v_on"));d.t=a}var h,g,f,d=a({eltype:"span",state:{"class":"last_v"},events:{contacts:function(){c()}}});d.stop=function(){h&&clearTimeout(h)};d.tick=c;d.render();c();return d},ia=function(){var b,a,h={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(b in h)if(b in document){a=h[b];break}return function(g){g&&document.addEventListener(a,
g);return!document[b]}}(),Ha=function(){var b,a,h,g=$("#favicon");return function(){DC.emit("tab_active");ia()?(document.title="MEXY.PRO",g.attr({href:"/img/favicon.png?"})):(b?(h="2",a="hey, listen"):(h="",a="you are not here"),b=!b,document.title=a,g.attr({href:"/img/favicon_message"+h+".png?"}))}}(),r=a(function(){var b=a({init:function(){this.insertAs("#loading_back")}}),c,h=a({attrs:{style:"background: none;","class":"loading_div"}}),g=a({eltype:"span",state:{"class":"loading_ball"}}),f=a({eltype:"span"}),
d=a({attrs:{"class":"loading_text"}});return{extend:{hide:function(){this.el.hide();b.el.hide();this.busy=!1;h.clearIntervals()},show:function(a){a?(d.el.show(),d.t=a):d.el.hide();this.el.show();b.el.show();this.busy||(this.busy=!0)},busy:!0},init:function(){c=this;this.insertAs("#loading").t="";h.DClist([g,f]);h.insertIn(c);d.insertIn(c)}}}),aa=a(function(){var b=1,c=a(),h=function(){function g(){if(b){var a=c.el.crec().width,k=a;window.innerHeight<a&&(a=k=window.innerHeight);if(k){var C,t,x,p,X,
B,T=a>k?k/2.75:a/2.75,Wa=0.0015*T,ta=T/5,Xa=F.ci,Y=F.length,r=a/2,E=k/2;p=window.devicePixelRatio||1;B=l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1;var A=p/B;p!==B?(p=a,B=k,u.width=p*A,u.height=B*A,u.style.width=p+"px",u.style.height=B+"px",l.scale(A,A)):(u.width=a,u.height=k);ja!=u.width&&(ja=u.width);l.beginPath();l.arc(r,E,T,0,q);l.fillStyle="rgba(255, 255, 255,.75)";l.fill();h&&(x=m,x>a/2&&(x=a/
2),l.drawImage(z,r-x/2,E-x/2,x,x));l.save();l.lineWidth=1;for(B=0;B<G.all.length;B++)if(A=G.all[B])l.beginPath(),l.arc(A.cx,A.cy,A.r*A.s,0,q),p=1-(A.s-A.min)/(A.max-A.min),l.strokeStyle="rgba(70,70,70,"+p+")",l.stroke(),A.s+=A.sk,A.s>A.max&&(G.all[B]=!1);l.restore();for(A=0;A<F.size;A++){F.all[A]||(F.all[A]={arr:[],last:!1});C=F.all[A];B=C.arr;p=C.last;p||(C.last=p={vr:100,imin:5,imax:15},p.vx=d(-p.vr,p.vr)/p.vr+0.1,p.vy=d(-p.vr,p.vr)/p.vr+0.1,p.x=f(0,a),p.y=f(0,k),p.i=f(p.imin,p.imax));p.sx=f(ta/
10,ta);p.sy=f(ta/10,ta);x={x:p.vx*p.sx,y:p.vy*p.sy};C=p.x+x.x;t=p.y+x.y;Math.sqrt((C-r)*(C-r)+(t-E)*(t-E))>T&&(x={x:C-r,y:E-t},x.a2=Math.atan2(x.x,x.y),C=r+T*Math.cos(x.a2-Math.PI/2),t=E+T*Math.sin(x.a2-Math.PI/2),p.vx=-p.vx,p.vy=-p.vy,x=T/50,G.all[G.now]={cx:C,cy:t,r:x,min:1,max:3*x||1.2,s:1,sk:x/10||0.01},G.now++,G.now>=G.max&&(G.now=0));p.x=C;p.y=t;p.i--;p.i<p.imin&&(p.vx=d(-p.vr,p.vr)/p.vr+0.1,p.vy=d(-p.vr,p.vr)/p.vr+0.1,p.i=f(p.imin,p.imax));B[F.ci]={x:C,y:t};C=[];if(1<B.length)for(p=[],t=Xa;0<=
t;t--)p.push(B[t]),C.push([t,B[t].x]),0==t?t=B.length:t==B.length&&(t=-1),p.length>=B.length&&(t=-1);else p=B;l.lineCap="round";l.lineWidth=5;for(B=0;B<Y;B++)if(t=p[B],X=p[B+1]){0==A?l.fillStyle="rgba(0, 0, 0, "+(1-B/Y)+")":1==A?l.fillStyle="rgba(235, 0, 0, "+(1-B/Y)+")":2==A?l.fillStyle="rgba(15, 135, 235, "+(1-B/Y)+")":3==A&&(l.fillStyle="rgba(100, 100, 250, "+(1-B/Y)+")");var v=B*Wa;1>v&&(v=1);C=t.x;t=t.y;x=X.x;X=X.y;var y=v,n=Math.atan2(x-C,X-t);l.beginPath();var D=Ya-n;l.arc(C,t,y,D,Math.PI+
D);l.arc(x,X,v,-n,Math.PI-n);l.closePath();l.fill()}}F.ci++;F.ci==Y&&(F.ci=0)}L&&clearTimeout(L);L=setTimeout(g,ka)}}function f(b,a){return Math.floor(Math.random()*(a+1-b))+b}function d(b,a){return f(0,1)?f(1,a):f(b,-1)}var k=a({eltype:"canvas",attrs:{style:"top:0;left:0;"}}),m=200,z=new Image(m,m);z.src="/img/logo.png";var h=0;z.onload=function(){h=1};k.insertIn(c);c.el.css({margin:"0 auto",overflow:"hidden",position:"relative"});var u=k.el,l=u.getContext("2d"),F={ci:0,all:[],length:21,size:4},
G={all:[],now:0,max:3*F.size},L=0,Ya=180/(180/Math.PI),q=2*Math.PI,ka=17,ja;return{run:function(){b=1;g()},stop:function(){b=0}}}();return{extend:{run:function(b,a){b&&c.insertIn(b);h.run();a||(a={});var d=a.sz;d||(d=500);c.el.css({"max-width":d})},stop:function(){b&&h.stop()}},init:function(){this.el=c.el}}}),wa=a({init:function(){this.insertIn(".head")}}),xa=a(function(){var b,c={},h,g=c.pic=a({attrs:{"class":"u_picture_mini"},extend:{set:function(b){if(0==b)return this.el.style.backgroundImage=
null;this.el.css({"background-image":"url("+b+")"})}}}),f=c.nm=a({attrs:{"class":"interlocutor_name"}}),d=c.on=a({attrs:{"class":"is_interlocutor_online"}}),k;return{state:{opened:!1},events:{contacts:function(){if(H)b.online()}},extend:{hide:function(){b.el.hide();k&&(clearTimeout(k),k=0)},show:function(){b.el.show()},online:function(){k&&(clearTimeout(k),k=0);var a;(a=D(h))&&a.online?a="on":(a=a.last_v||0)&&"on"!=a&&(a=(new Date(a)).getTime());if("on"==a)a="online";else if(a){var c=ea();a=Math.round((c-
a)/1E3);2>a?(a="online",k=setTimeout(b.online,1E3)):86400<=a?(a=Math.round(10*a/86400)/10,a=100>a?a+" d ago":"offline"):3600<=a?(a=Math.round(10*a/3600)/10,a+=" h ago",k=setTimeout(b.online,36E4)):60<=a?(a=Math.round(a/=60),a+=" min ago",k=setTimeout(b.online,6E4)):(a+=" sec ago",k=setTimeout(b.online,1E3))}else a="offline";d.t=a},draw:function(a){if(H){if(a)h=a;else{if(!h)return console.log("header interlocutor error");a=h}g.set(0);var c=D(a);c?(f.t=c.name,c.userdata&&c.userdata.crop_photo&&g.set(V(c.userdata.crop_photo)),
b.show(),b.online()):(D.load(a,function(b){console.log("user not found",a)},function(c){b.draw(a)}),f.t="loading . . .")}else h=!1,b.hide()}},init:function(){b=this;qa.any(function(){b.draw()});this.parse('<div class="is_online">\n{pic}\n<div class="inlb" style="position:relative;vertical-align: top;">\n{nm}{on}\n</div>\n</div>',c).insertIn(wa)}}}),Za=a(function(){return{getSelf:function(a){},eltype:"a",state:{"class":"b",text:"logout"},attrs:{href:"/logout",
id:"logout"},events:{click:function(a){s.disconnect();delete S.token;S.clear();location.href="/"}}}}),N=a(function(){function b(b){return a(function(){var a;return{getSelf:function(b){a=b},eltype:"a",state:{"class":"back_line menu_a",page:b.p,text:b.t?b.t:b.p},attrs:{href:"/"+b.p},extend:{here:function(){d&&d.removeClass("here");a.addClass("here");d=a;c.close()}},events:{click:function(b){n(b);U(a.state.page);a.here()}}}})}var c,h={},g,f,d,k=[],m,z;g=a({events:{click:function(){N.close()}},init:function(){this.insertIn(ha).el.attr({id:"m_back"})}});
h.friends=a();k.push(h.ac=b({p:"contacts",t:"all contacts"}));k.push(h.im=b({p:"im"}));k.push(h.sc=b({p:"sc",t:"secret talks"}));k.push(h.st=b({p:"settings"}));k.push(h.ab=b({p:"about"}));k.push(h.lg=b({p:"/",t:"login"}));k.push(h.la=Za);m=h.mp=a({attrs:{"class":"u_picture"},extend:{set:function(a){this.el.css({"background-image":"url("+a+")"})}},events:{u_data:function(){if(q.userdata.crop_photo){var a=V(q.userdata.crop_photo);m.set(a)}}}});z=h.mnm=a({attrs:{"class":"inlb"},extend:{set:function(a){this.t=
a}}});var w,u=a(function(){var a;return{extend:{set:function(b){a!=b&&("bottom"==b?u.el.css({bottom:0,top:"auto"}):u.el.css({bottom:"auto",top:0}),a=b)}},initLater:function(){w!=(q.authorized?!0:!1)&&(w=q.authorized?!0:!1,f.DClist([]),w?this.parse('\n<div class="menu-items">\n<div class="center" id="my_back_line">\n{mp}\n<div class="inlb" style="vertical-align:top;">\n{mnm}<br />\n</div>\n</div>\n{ac}\n{im}\n{sc}\n{friends}\n{st}\n{ab}\n<div class="back_line center" style="padding: 5px 0;margin-top: 15px;">{la}</div>\n</div>\n',
h).insertIn(f):this.parse('\n<div class="menu-items">\n{lg}\n{ab}\n</div>\n',h).insertIn(f),c.position())}}});f=a({state:{"class":"menu"}}).insertIn(ha);var l=!1;return{state:{"class":"menu_b",html:'<div class="menu_lines" style="margin-top:10px;"></div><div class="menu_lines"></div><div class="menu_lines"></div><div class="menu_notify"></div>'},events:{click:function(){c.open("top")},u_login:function(){q.authorized?z.set(q.name):z.set("")}},
extend:{open:function(a){u.set(a);l=!0;g.addClass("m_back_show");f.addClass("menu_opened")},close:function(){l=!1;g.removeClass("m_back_show");f.removeClass("menu_opened")},toggle:function(a){l?c.close():c.open(a)},friends:function(){},position:function(){var a=J.el.crec(),b=f.el,c=b.crec();window.innerWidth>a.width+2*c.width?b.css({right:a.right-a.width-c.width}):b.css({right:0})},activate:function(a){k.find(function(b){b.state.page==a&&b.here()})},set_my_pic:function(a){m.set(a)}},init:function(){c=
this;this.insertIn(wa);u.init();q.authorized&&c.friends()}}}),Ia=a(function(){var b,c=a({state:{"class":"contextmenu",html:'\n<div class="div">\n<div class="link">text</div>\n<div class="link">app</div>\n<div class="link">text</div>\n</div>\n<div class="div">\n<div class="link">app</div>\n<div class="link">access</div>\n<div class="link">app</div>\n</div>\n<br>\n<div class="div2">\n<div class="link">link</div>\n<div class="link">option</div>\n<div class="link">one more</div>\n</div>\n<div class="div2">\n<div class="link">link text</div>\n<div class="link">option</div>\n<div class="link">improve</div>\n</div>\n'}});
return{extend:{open:function(){ga||(c.el.show(),ga=1);b&&(clearTimeout(b),c.removeClass("show_up_once"));c.addClass("show_up_once");b=setTimeout(function(){c.removeClass("show_up_once")},200);var a=c.el.crec();c.el.css({left:e.clientX-a.width/2,top:e.clientY-a.height/2})},close:function(){ga&&(ga=0,c.el.hide())}},init:function(){c.insertIn(ha)}}}),I=a({attrs:{id:"log"},extend:{is:function(a,c){c||(c=900);var h=this;this.el.show();this.t=a;h.clearTimeouts();this.timeout(function(){h.el.hide()},c)},
"long":function(a){this.is(a,2500)},until:function(a){"undefined"==typeof a?this.el.hide():(this.el.show(),this.t=a)}},init:function(){this.insertIn(ha)}}),Ja=a({state:{html:'<div class="back_line inlb" style="padding: 0 10px;margin-top: 20px;">\n<h2>MEXY.PRO</h2>\n<p>Enjoy awesomeness while interacting with others</p>\n<p>Free & Fast , Beautiful & Secure</p>\n<p>And better with time</p>\n</div>'}}),y=a(function(){function b(){H=0;Q.reset();r={};w="";
G=s=l=0;L={};q={}}function c(a){a>w&&(w=a)}function h(){k.el.scrollTop=k.el.scrollHeight}function g(a){if(!l)I.is("wrong conversation",void 0);else if("sc"!=Z){var b=a.data;F++;v("im",{act:"save",data:b,cid:l,gid:a.gid,after:w},function(a){if(a.gid&&a.mid){if(c(a.mid),y.oper({ok:1,gid:a.gid,mid:a.mid}),a.ms){var b=q[a.mid];a.ms.reverse().forEach(function(a){Q(a,b.el)});Q.nameBefore(b.el)}}else I.long(a.reason)})}}function f(){H&&(ia()&&G&&l==G)&&v("im",{act:"read",cid:G,before:w},function(a){a.ok&&
(G=0)})}var d={},k,m,z,w,u,l,F=1,G,L,q,r,ka,ja=a({eltype:"audio",events:{canplaythrough:function(){ja.ready=1},tab_active:function(){this.el.pause()}},init:function(){a({eltype:"source",attrs:{src:"/other/15bells.mp3"}}).insertIn(this);this.play=function(){this.ready&&(this.el.currentTime=0,this.el.play())}}}),Q=function(){var b,d,f,l,z,w,m,C,v=function(E,A){d=l=0;f="";E?E._id&&E.data&&(z=E.data,c(E._id)):(E={},l=1,z=t.el.value,t.v="");var v=!1===E.viewed;if(fa(E.sender))f=" lright",d=1;else if(E.sender!=
u){Ea();return}!d&&v&&(G=E.cid);w=Sa(E.time);w!=C&&(a({state:{"class":"mdate",text:w}}).insertIn(k),C=w);var n=a({state:{"class":"l"+f}}),Q=a({eltype:"span",state:{"class":"mtime",text:l?"":Da(E.time)}});n.data.t=function(a){Q.t=Da(a)};var y=a({state:{"class":"block",text:z}});if(d){1!=b&&(b=1,m=a({state:{"class":"m_sender_name",text:"Me:"}}),m.insertIn(n));var s;if(!1===E.viewed||l)s=a({state:{"class":"m_unread"}}),s.insertIn(n);Q.insertIn(n);y.insertIn(n);l&&(r[F]=n,g({data:z,gid:F}))}else{if(0!=
b){b=0;var H=D(u).name.split(" ")[0];m=a({state:{"class":"m_sender_name",text:H+":"}});m.insertIn(n)}y.insertIn(n);Q.insertIn(n);x.stop()}A?k.el.insertBefore(n.el,A):n.insertIn(k);E._id&&(n._id=E._id,d&&v&&(L[E._id]=n),q[E._id]=n);n.read=function(){s&&s.remove()};n.pulsar=s;x.is()?x.init():ka=1;ia()||ja.play();n.addClass("appear_once");h()};v.reset=function(){b=null;C=0};v.nameBefore=function(c){1!=b&&(b=1,m=a({state:{"class":"m_sender_name",text:"Me:"}}),m.render(),c.insertBefore(m.el,c.firstChild),
h())};return v}();k=a({state:{"class":"chat"}});var s,C,t=d.in=a({eltype:"textarea",attrs:{placeholder:"Write a message","class":"inp",id:"textp"},state:{val:""},events:{input:function(a){this.value.match(/[\n\r]/g);a=Date.now();150>a-C||(x.draw({uid:fa()}),C=a,!D.isOnline(u)||700>a-s||(s=a,v("typing",{uid:u})))},keydown:function(a){13!=a.keyCode||a.shiftKey||(n(a),z.onclick())}}});z=d.sbt=a({eltype:"button",state:{"class":"b",text:"\u27a4"},attrs:{id:"send"},events:{click:function(){var a=t.el,b=
a.value.trim();500<b.length&&(b=b.substr(0,500),b=b.trim());b!=a.value&&(t.v=b);a.focus();b.length&&(t.v=b,Q(),x.stop(1))}}});m=a({init:function(){this.parse('\n<div class="under_chat">\n<div style="padding: 0 50px 0 51px;position: relative;">\n{in}\n<input id="attach_f" type="button" class="b" value="+">\n{sbt}\n</div>\n</div>',d)}});var x=function(){var b=a({state:{"class":"lright my_typing",html:'<div class="in_typing"></div>'}}),
c=a({state:{"class":"in_typing"}}),d=a({state:{"class":"typing_div"}}),g,f,l=0,z=0,w,m=function(){var a=b.el.crec().height,c=d.el.crec().height;a&&c<a&&(c=a);c!=g&&(h(),g=c)};return{init:function(){d.insertIn(k)},is:function(){return l||z?1:0},stop:function(a){a?l&&(f&&clearTimeout(f),b.el.remove(),m(),l=0):z&&(w&&clearTimeout(w),c.el.remove(),m(),z=0)},draw:function(a){ka&&(x.init(),ka=0);fa(a.from)?(b.insertIn(d),f&&clearTimeout(f),l=1,f=setTimeout(function(){x.stop(1)},1800)):(c.insertIn(d),w&&
clearTimeout(w),z=1,w=setTimeout(function(){x.stop()},1800));m()}}}();return{events:{tab_active:function(){f()}},extend:{start:function(a,b){H=1;a&&(u=a.target,l=a.cid);if(b)return na();v("user",{act:"is_online",uid:u},function(a){D.online(u,1==a);xa.draw(u);y.load();y.adapt()})},check:function(){var a=ua().cid;a!=l&&(a?u?(l=a,y.start()):Va(a,function(b,c){if(b)return Ea();y.start({cid:a,target:c})}):(xa.hide(),H=0))},adapt:function(){k.el.css({height:J.el.height()-15-wa.el.height()-m.el.height()});
h()},add:function(a){a.length&&(a.reverse().forEach(function(a){a._id>w&&Q(a)}),f(),y.adapt())},load:function(){if(H&&l){var a={act:"load",cid:l};w&&(a.after=w);v("im",a,function(a){a.ok&&y.add(a.ok)})}else console.log("unable to load ms")},received:function(a){a&&l==a.cid&&y.load()},viewed:function(a){if(H&&ia()&&a.cid==l)for(var b in L)a.before<b||(L[b].read(),delete L[b])},oper:function(a){if(a.ok){if(a.gid&&a.mid){var b=a.gid;if(!r[b]){I.long("strange thing happened");return}var c;L[a.mid]=c=
r[b];q[a.mid]=c;c._id=a.mid;c.data.t();delete r[b]}y.adapt()}},focus:function(){t.el.focus()},typing:function(a){a.from==u&&x.draw(a)},close:function(){b();xa.hide()}},initLater:function(){b();this.DClist([k,m]);k.t="";x.init();return this}}}),La=a(function(){var b=a({state:{html:'<div class="back_line inlb" style="margin: 20px 0;padding: 0 10px;">Or</div>'}}),c=a(),h=a(function(){var b={},c,d,g;d=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});
g=b.em=a({eltype:"input",attrs:{"class":"inp",placeholder:"Email",type:"email",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(n(a),f.onclick())}}});var f=b.bt=a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){pa(g.v)?r.busy||(r.show(void 0),s.emit("restore",{email:g.v},function(a){r.hide();a.reason?d.is(a.reason):a.ok&&d.is("Check your inbox!")}),d.is("")):(c.fail("invalid email"),g.el.focus())}}});b.btc=a({eltype:"button",attrs:{"class":"b"},state:{html:"cancel"},
events:{click:function(a){k.el.show("inline-block");c.el.hide()}}});return{extend:{fail:function(a){O(c);d.is(a)},appear:function(){c.el.show("inline-block")}},init:function(){c=this;this.parse('\n<div style="display: inline-block;" class="enter_form">\n<div class="back_line">Reset password via email:</div>\n<div style="padding-right: 22px;">\n{em}\n</div>\n{bt}{btc}\n{rs}\n</div>\n',b);this.el.hide()}}}),g=a({state:{text:"Create new password"}}),
f=a(),d=a(function(){var b={},c,g,f;g=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});f=b.p1=a({eltype:"input",attrs:{"class":"inp",placeholder:"type new password",type:"password",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(n(a),h.onclick())}}});var k=b.p2=a({eltype:"input",attrs:{"class":"inp",placeholder:"repeat password",type:"password",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(n(a),h.onclick())}}}),
h=b.bt=a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){a=f.v;var b=k.v;if(!a)return f.el.focus();if(8>a.length)c.fail("invalid password"),f.el.focus();else{if(!b)return k.el.focus();b!==a?(c.fail("password mismatch"),k.el.focus()):r.busy||(r.show(void 0),s.emit("change_pass",{email:window.restore_email,key:window.restore_key,newpass:f.v},function(a){r.hide();a.reason?g.is(a.reason):a.ok&&d.DClist([q,v])}),g.is(""))}}}}),m=b.btc=a({eltype:"button",state:{"class":"b",
html:"cancel"},events:{click:function(a){window.restore_email=!1;na()}}}),q=a({state:{text:"Success! Now, login with new password"}}),v=a({eltype:"button",state:{text:"ok","class":"b"},events:{click:function(){m.onclick()}}});return{extend:{fail:function(a){O(c);g.is(a)},appear:function(){c.el.show("inline-block")}},init:function(){c=this;this.parse('\n<div style="display: inline-block;" class="enter_form">\n<div class="back_line">remember it:</div>\n<div style="padding-right: 22px;">\n{p1}<br />\n{p2}\n</div>\n{bt}{btc}\n{rs}\n</div>\n',
b)}}}),k=a(function(){var b={},c,d,g,f,m;d=b.rs=a(function(){var a;return{getSelf:function(b){a=b},extend:{is:function(b){a.t=b}},attrs:{"class":"form"}}});g=b.em=a({eltype:"input",attrs:{"class":"inp",placeholder:"login",maxlength:80},events:{keydown:function(a){13==a.keyCode&&(n(a),m.onclick())}}});f=b.ps=a({eltype:"input",attrs:{"class":"inp",placeholder:"Password",type:"password",maxlength:20},events:{keydown:function(a){13==a.keyCode&&(n(a),m.onclick())}}});m=b.bt=a({eltype:"button",attrs:{"class":"b"},
state:{html:"login"},events:{click:function(a){n(a);a=g.el.value;if(4>a.length)c.fail("invalid login"),g.el.focus();else{var b=f.el.value;8>b.length?(c.fail("invalid password"),f.el.focus()):r.busy||(a={login:a,pass:b},r.show(),v("signin",a,function(a){r.hide();a.token?(S.token=a.token,location.href="/contacts"):k.fail("Nope, "+a.reason)}),d.is(""))}}}});b.ft=a({eltype:"span",state:{"class":"forgot_password",text:"restore access?"},events:{click:function(){k.el.hide();h.appear()},mousedown:function(){}}});
return{extend:{fail:function(a){O(c);d.is(a)}},init:function(){c=this;this.parse('\n<form class="enter_form">\n<div class="back_line">Sign in:</div>\n<div style="padding-right: 22px;">\n{em}<br />\n{ps}\n</div>\n{bt}\n{ft}\n{rs}\n</form>\n',b)}}}),m=a(function(){var b,c=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"name"},events:{keydown:function(a){if(13==a.keyCode)h.onclick()},input:function(){var a=
this.value.replace(/\s/g,"").substr(0,14);a!=this.val()&&this.val(a)}}}),d=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"last name"},events:{keydown:function(a){if(13==a.keyCode)h.onclick()},input:function(){var a=this.value.replace(/\s/g,"").substr(0,14);a!=this.val()&&this.val(a)}}}),g=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"login"},events:{keydown:function(a){if(13==a.keyCode)h.onclick()}}}),f=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"email"},
events:{keydown:function(a){if(13==a.keyCode)h.onclick()}}}),k=a({eltype:"input",state:{"class":"inp"},attrs:{placeholder:"password",type:"password"},events:{keydown:function(a){if(13==a.keyCode)h.onclick()}}}),h=a({eltype:"button",state:{text:"next","class":"b"},events:{click:function(){var a=c.el.value.replace(/\s/g,""),h=d.el.value.replace(/\s/g,""),n=g.el.value.trim(),C=k.el.value,t=f.el.value.trim();4>a.length?(c.el.focus(),a.length&&b.fail("wrong name")):4>h.length?(d.el.focus(),h.length&&b.fail("wrong name")):
4>t.length||!pa(t)?(f.el.focus(),t.length&&!pa(t)&&b.fail("wrong email")):4>n.length?(g.el.focus(),n.length&&b.fail("wrong login")):4>C.length?(k.el.focus(),C.length&&b.fail("wrong password")):(m.t="processing . . .",v("signup",{name:a+" "+h,login:n,email:t,pass:C},function(a){var b="";a.reason?b=b+"failed\n"+JSON.stringify(a,null,4):a.ok&&(b="Success! Check your inbox!");m.t=b}))}}}),m=a({state:{"class":"form"}});a({eltype:"button",attrs:{"class":"b"},state:{html:"next"},events:{click:function(a){pa(f.el.value)?
r.busy||m.is(""):(b.fail("invalid email"),f.el.focus())}}});var n=a({eltype:"button",state:{"class":"b",text:"register"},events:{click:function(){q.el.show("inline-block");n.el.hide()}}}),q=a().parse('\n<div style="display: inline-block;margin-bottom: 80px;" class="enter_form">\n<div class="back_line">Sign up with email:</div>\n<div style="padding-right: 22px;">\n{fn}<br />\n{sn}<br />\n{em}<br />\n{a}<br />\n{b}<br />\n{c}{d}\n</div>\n</div>',{fn:c,
sn:d,em:f,a:g,b:k,c:h,d:m});q.el.hide();return{extend:{fail:function(a){O(b);m.t=a}},init:function(){b=this;this.parse("\n<div>{a}{b}\n</div>\n",{a:n,b:q})}}});return{state:{"class":"form center"},attrs:{style:"padding-bottom: 120px;"},groups:"route",initLater:function(){aa.run(c);var a;window.restore_email&&window.restore_key?(f.h="for <b>"+window.restore_email+"</b>",a=[c,g,f,d]):a=[c,Ja,k,h,b,m];this.DClist(a);return this}}}),Ma=a(function(){var b=a(function(){function c(b){b=
da(b);var d=a(),g={},f=b._id,k,h;h='<div class="back_line"><div class="u_picture"></div>'+('<div class="inlb" style="vertical-align:top;"><div class="inlb">'+b.name+"</div><br />");f!=q.id&&(null==b.status?k="request":0==b.status?b.initiator_me?h+='<div class="green">requested</div>':k="accept":1==b.status&&(k="talk"));if(k){var m=g.bt=a({eltype:"button",attrs:{"class":"b "},state:{text:k},events:{click:function(){1!=b.status?(r.show(void 0),v("contact",{data:{target:f},type:k},function(a){r.hide();
Pa(a,function(a){"request"==k?m.replaceWith('<div class="green">requested</div>',1):m.replaceWith('<div class="green">accepted</div>',1)})})):va(f)}}});h+="{bt}"}d.parse(h+"</div></div>",g);return d}var g,f,d,k;k=a({eltype:"input",attrs:{"class":"inp",style:"max-width:150px;",placeholder:"Type name"},extend:{fail:function(){O(k);k.el.focus()}},events:{keypress:function(a){if(13==a.keyCode)g.onclick(a)}}});g=a({eltype:"button",state:{"class":"b",text:"search"},events:{click:function(a){r.busy||(a=
k.el.value,3>a.length?(O(f),k.fail(),f.fail("enter more letters")):(a={name:a},f.is("searching..."),v("search",{data:a,type:"people"},function(a){r.hide();a=a.ok;var d=[],g=0;if(a&&a.length){for(var f=0;f<a.length;f++)g=a[f],d.push(c(g));b.res(d)}else b.fail()})))}}});f=a({attrs:{"class":"center back_line inlb",style:"padding: 5px;"},extend:{is:function(a){f.el.show("");f.t=a},fail:function(a){O(f);k.fail();a?f.is(a):f.is("not found");d.t=""}}});var m=a({eltype:"p",state:{text:"Search for people"}}),
z=a({attrs:{"class":"center back_line",style:"margin: 20px 0;padding: 1px 5px 10px;"},init:function(){this.DClist([m,k,g])}});d=a();return{extend:{res:function(a){f.is("hey, there are results:");d.t="";a.map(function(a){a.insertIn(d)})},fail:function(){f.fail()},clear:function(){f.el.hide();k.v="";d.t=""}},init:function(){this.clear();this.DClist([z,f,d]);return this}}}),c=a(function(){var h=a({state:{"class":"contacts_list"}}),g=a(),f=a({eltype:"button",state:{"class":"b",text:"refresh"},events:{click:function(){v("contact",
{act:"show_all"},function(a){a.arr&&(v("contact",{act:"show_userdata_lots",idarr:a.arr},function(a){if(a.arr)for(var b in a.arr){var c=a.arr[b];c&&c.forEach(function(a){return D.updateData(b,a)})}}),a.arr.forEach(function(a){a.status=1;a.last_v&&(a.last_v=(new Date(a.last_v)).toISOString());D.add(a._id,a);if(a.online)D.online(a._id,1)}),c.draw())});b.clear()}}}),d=a({attrs:{"class":"center back_line inlb"},extend:{is:function(a){d.el.show();d.t=a},fail:function(a){O(d);a?d.is(a):d.is("You have no friends yet")}}});
d.el.hide();var k={};return{extend:{draw:function(){var a=da(D.getFriends());if(a){d.el.hide();for(var b in a)"length"!=b&&(k[b]||(k[b]=Ta(a[b]).insertIn(h)));for(var c in k)a=k[c],a.timer&&a.update()}else d.fail()},fail:function(){d.fail()},load:function(){f.onclick()},stop:function(){for(var a in k){var b=k[a];b.timer&&b.timer.stop()}}},init:function(){this.DClist([d,f,g,h]);return this}}});return{state:{"class":"form center"},groups:"route",extend:{title:"Contacts",onleave:function(){c.stop()}},
events:{u_login:function(){q.authorized&&c.load()}},initLater:function(){c.draw();this.DClist([b.init(),c]);return this}}}),Na=a(function(){var b=a(function(){function b(a){a=a.split("_");return fa()==a[1]?a[2]:a[1]}function h(d){var f=b(d.users),g=D(f);g||(g={name:"loading"},D.load(f,function(){},function(){g=D(f);h.t=g.name}));var h=a({eltype:"span",state:{text:g.name,"class":"message_preview_name"}}),n=d.data.substr(0,90),q=d.sender==fa();n.length!=d.data.length&&(n+="...");var n=a({eltype:"span",
state:{text:q?"Me: "+n:n}}),l=a({events:{click:function(){va(f)}}}),F=a({state:{"class":"u_picture_mini"}});l.update=function(a){a&&!q&&(a.viewed?r.removeClass("new_message_line"):r.addClass("new_message_line"));a=D(f);a.userdata&&a.userdata.crop_photo&&F.el.css({"background-image":"url("+V(a.userdata.crop_photo)+")"})};qa(f,l.update);var r=a().parse('<div class="back_line message_preview_line">{ph}<div class="inlb padl5">{a}<br />{b}</div></div>',{ph:F,a:h,b:n}).insertIn(l);l.update(d);return l}
var g,f={};return{initLater:function(){g||(g=this);v("conv",{act:"get_list"},function(b){if(b.ok){var c=[];b.ok.forEach(function(a){var b;if(f[a.cid])return b=f[a.cid],c.push(b),b.update(a);b=h(a);f[a.cid]=b;c.push(b)});b.ok.length||c.push(a({state:{text:"you have no conversations yet","class":"center back_line"}}));g.DClist(c)}});return g}}});return{state:{"class":"form"},extend:{title:function(){return ua().cid?!1:"Instant messages"}},groups:"route",initLater:function(){var a=[];ua().cid?a.push(y.init()):
a.push(b.init());this.DClist(a);return this}}}),Oa=a(function(){var b=a({state:{html:'<div style="margin: 20px;padding: 10px;background: rgba(63, 63, 63, 0.72);">\n<p style="color:white;">Not available yet</p>\n<p style="color:white;">You can use <a href="https://temp.mexy.pro" target="_blank" style="color: #ff8282;font-weight: bold;">temp.mexy.pro</a> instead</p>\n</div>'}});a(function(){var b=a({state:{"class":"contacts_list"}}),h=a({eltype:"button",state:{"class":"b",text:"refresh"},
events:{click:function(){aa.stop();aa.run(b)}}}),g=a({attrs:{"class":"center back_line inlb"},extend:{is:function(a){g.el.show("");g.change({text:a})},fail:function(a){O(g);a?g.is(a):g.is("No friends online")}}});g.el.hide();return{extend:{draw:function(){var a=da(P.on);b.change({html:""});var d=0;a&&a.length&&(g.el.hide(),a.map(function(a){R(a);if(a=f_get_one_u(a))f_draw_user_from_search(a).insertIn(b),d++}));d||g.fail()},fail:function(){g.fail()}},init:function(){this.DClist([g,h,b]);return this}}});
return{state:{"class":"form center"},extend:{title:"Secret talks"},groups:"route",initLater:function(){this.DClist([b]);return this}}}),za=DC.make(function(){var b=a(function(){function b(c){return a(function(){var a;return{getSelf:function(b){a=b},eltype:"div",state:{"class":"choose_theme choose_radio",text:c.tx},data:{theme:c.t},extend:{sel:function(){k&&k.removeClass("selected_radio");a.addClass("selected_radio");k=a;z!=m?f.el.show():f.el.hide()}},events:{click:function(b){n(b);a.sel();ca(c.t)}}}})}
var c={},f,d=[],k,m,z;f=c.bt=a({eltype:"button",state:{"class":"b",text:"save"},events:{click:function(a){n(a);var b=m;b||(b="");r.show(void 0);v("settings",{prop:"theme",val:b},function(a){r.hide();a.ok&&(ca(b,1),f.el.hide())})}}});f.el.hide();d.push(c.bw=b({t:"black_white_mn",tx:"black & white"}));d.push(c.dm=b({t:"dark_mn",tx:"dark colours"}));d.push(c.bm=b({t:"bright_mn",tx:"bright enough"}));d.push(c.gl=b({t:"grey_mn",tx:"grey lines"}));d.push(c.eb=b({t:"easy_blue_mn",tx:"easy blue"}));if(!q.css)c.bw.onclick();
var w=a({init:function(){this.parse('\n<div>\n<p>Select main theme:</p>\n<div class="center">\n{bw}\n{dm}\n{bm}\n{gl}\n{eb}\n</div>\n<div>{bt}</div>\n</div>\n',c)}});return{extend:{set:function(a,b){var c=Fa?"/raw_":"/";d.find(function(d){d.data.theme==a&&(Ga.el.attr("href")!=c+"css/"+q.css.theme+".css?v="+App_version&&(Ga.el.attr({href:c+"css/"+q.css.theme+
".css?v="+App_version}),m=a),b&&(z=a),d.sel())})}},init:function(){return w}}}),c=a(function(){function b(a){if(a.files&&a.files[0]){var c=new FileReader;c.onload=function(a){l.open(a.target.result)};c.readAsDataURL(a.files[0])}}var c,f=a({state:{"class":"preview_div_wrap"}}).iIn(ha),d=a({state:{"class":"preview_f_div"}}).iIn(f),k=a({state:{"class":"crop_img_wrap"}}).iIn(d),d=a().iIn(d),m=a({eltype:"button",state:{"class":"b",text:"upload"},events:{click:function(){l.upload()}}}).iIn(d);a({eltype:"button",
state:{"class":"b",text:"cancel"},events:{click:function(){l.cancel()}}}).iIn(d);var r=DC.temp({eltype:"input",attrs:{type:"file"},events:{change:function(){b(this)}}}),w=a({state:{"class":"center"}});a({state:{"class":"back_line",text:"How about your profile photo?"}}).iIn(w);var u=a({attrs:{"class":"profile_picture"},extend:{set:function(a){this.el.css({"background-image":"url("+a+")"})}},events:{u_data:function(){if(q.userdata.crop_photo){var a=V(q.userdata.crop_photo);u.set(a)}}}}).iIn(a().iIn(w));
DC.temp({eltype:"button",state:{text:"change photo","class":"b"},events:{click:function(){r.el.click()}}}).iIn(w);var l=function(){function b(a,c){var d=l.el,f=parseInt(d.css("left"))||0,g=parseInt(d.css("top"))||0,h=a.clientX-f,k=a.clientY-g;K.f||(K.f=function(b){a=c?b.changedTouches[0]:b;b=a.clientX-h;var f=a.clientY-k,g=d.crec();0>b&&(b=0);0>f&&(f=0);b+g.width>s.width&&(b=s.width-g.width);f+g.height>s.height&&(f=s.height-g.height);d.css({left:b,top:f})})}function d(a,b){var c=l.el,f=c.crec(),g=
parseInt(c.css("left"))||0,h=parseInt(c.css("top"))||0,k=300*(s.width/s.naturalWidth),m=a.clientX,n=a.clientY;K.f||(K.f=function(d){a=b?d.changedTouches[0]:d;d=a.clientX-m+f.width;var l=a.clientY-n+f.height;d<k&&(d=k);l<k&&(l=k);g+d>s.width&&(d=s.width-g);l>s.height-h&&(l=s.height-h);d<l&&(l=d);l<d&&(d=l);c.css({width:d,height:l})})}function h(a){if(c){var b=a.arr;0==a.cur&&(a.total=b.length);var d=a.cur,f=a.total;d==f?"crop"==a.type?(u.t="saving crop photo...",v("save_crop_photo",{loid:a.loid},function(a){a.crop_photo&&
(q.userdata.crop_photo=a.crop_photo,DC.emit("u_data"));u.t="done!";m.el.show("inline-block");y.cancel()})):"orig"==a.type&&(u.t="saving photo...",v("save_photo",{loid:a.loid},function(a){u.t="cropping photo...";y.crop(function(a){c=a;y.upload({type:"crop"})})})):v("upload",{bin:b[d],loid:a.loid},function(b){b&&b.reason?console.log("error happened"):(console.log("packet",d,"uploaded"),a.cur++,u.t="uploading... "+Math.floor(100*(d/f))+"%",h(a))})}}var l=a({state:{"class":"crop_img_border"},events:{mousedown:function(a){n(a);
b(a)},touchstart:function(a){n(a);sa=1;b(a.changedTouches[0],1)}}}).iIn(k);a({state:{"class":"crop_img_resize"},events:{mousedown:function(a){n(a);d(a)},touchstart:function(a){n(a);sa=1;d(a.changedTouches[0],1)}}}).iIn(l);var w=a({eltype:"img",state:{"class":"img_preview"}}).iIn(k),u=a({state:{"class":"back_line"}}).iIn(k),s=w.el;s.onload=function(){c=s.src;if(300>s.naturalWidth||300>s.naturalHeight)I.is("too liitle image",void 0),y.cancel()};var y={open:function(a){5E6<a.length?I.is("too large photo",
void 0):(w.el.src=a,l.el.css({left:0,top:0,width:100,height:100}),f.el.show(),m.el.show("inline-block"),u.t="")},cancel:function(){w.src="";r.v="";c=!1;f.el.hide()}},D=document.createElement("canvas");D.width=D.height=300;y.crop=function(a){var b=l.el,c=w.el,d=c.width/c.naturalWidth,f=b.crec().width/d;300>f&&(f=300);var g=parseInt(b.css("left"))||0,h=parseInt(b.css("top"))||0,k=D.getContext("2d"),m=new Image;m.onload=function(){k.drawImage(m,g/d,h/d,f,f,0,0,300,300);a(D.toDataURL())};m.src=c.src};
y.upload=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!c)return u.t="empty file data";fetch(c).then(function(a){return a.blob()}).then(function(b){console.log(b);if(4E6<b.size)return u.t="too large file";for(var c=[],d=0,f=Math.floor(b.size/4E4);d<=f;d++)c.push(b.slice(4E4*d,4E4*d+4E4));m.el.hide();b=h;d="";for(f=0;3>f;f++)d+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];b({arr:c,cur:0,loid:d,type:a.type||"orig"})})};
y.cancel();return y}();return{extend:{set:function(a){}},init:function(){return w}}});return{state:{"class":"form"},extend:{title:"Settings",theme:b,profile_photo:c},groups:"route",initLater:function(){this.DClist([b.init(),c.init()]);return this}}}),ya=a(function(){var b=a({state:{html:'<div class="back_line inlb" style="margin: 20px 0;padding: 0 10px;">MEXY.PRO is all you need to interact with others in this world</div>'}}),c=a();return{state:{"class":"form center"},extend:{title:"About"},groups:"route",
initLater:function(){aa.run(c);this.DClist([c,b,Ja]);return this}}});window.onpopstate=function(){U(location.pathname.substr(1),0)};DC.onwindow("resize",function(){Ca();H&&y.adapt()});!function(){var a,c,h,g=!1;document.createElement("div").addEventListener("test",function(){},{get passive(){g=!0;return!1}});window.addEventListener("touchstart",function(f){var d=f.changedTouches[0];c=d.clientX;h=d.clientY;g||n(f);a=1},g?{passive:!0}:!1);window.addEventListener("touchmove",function(f){if(sa)K.f&&K.f(f);
else{var d=f.changedTouches[0],k=d.clientX,d=d.clientY;a&&(g||n(f),35<Math.abs(k-c)?(N.toggle("bottom"),a=0):15<Math.abs(d-h)&&(a=0))}},g?{passive:!0}:!1);DC.onwindow("touchend",function(f){sa=a=c=0;K={}})}();DC.onwindow("mousedown",function(a){2==a.button?ra=[a.clientX,a.clientY]:ga&&Ia.close()});DC.onwindow("mousemove",function(a){K.f&&K.f(a)});DC.onwindow("mouseup",function(){K={}});DC.onwindow("contextmenu",function(a){if(ra){var c=ra;ra=0;var h=a.clientX,g=c[0]-h,f=c[1]-a.clientY;if(144<g*g+
f*f)return Ia.close(),12<h-c[0]?history.forward():12<c[0]-h&&history.back(),n(a)}a.ctrlKey||3!=a.which||(n(a),N.toggle())});DC.onwindow("keydown",function(a){a.altKey&&(n(a),N.toggle());H&&(a=String.fromCharCode(a.keyCode),/[\u0430-\u044f\u0451a-z0-9-_!-+ )]/i.test(a)&&y.focus())});!function(){var a="mexy.pro"==location.hostname?8443:80;80<a&&"https:"!=location.protocol&&(location.protocol="https:");s=io((80<a?"mexy-lepta.rhcloud.com":"")+":"+a,{transports:["websocket"],reconnectionAttempts:5})}();
I.until("connecting...");s.on("connect",function(){I.until();la=1;r.hide();s.sendBuffer=[];Ba()}).on("disconnect",function(a){la=0;oa("u_login")}).on("app_local_mode",function(a){Fa=1}).on("error",function(a){I.until("socket error")});ca();Ca();r.show("initialize...");ia(Ha);Ha()});
